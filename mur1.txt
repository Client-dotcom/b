--[[
    Ù†Ø¸Ø§Ù… ESP + Auto Shoot Ø§Ù„ÙƒØ§Ù…Ù„
    Ù†ÙØ³ Ø§Ù„Ù…Ù„Ù ØªÙ…Ø§Ù…Ø§Ù‹ Ù„ÙƒÙ† Ù…Ø¹ GUI Ø¨Ø³ÙŠØ·
]]

-- ======== Ø§Ù„Ø®Ø¯Ù…Ø§Øª ========
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- ======== Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© GUI Ø¨Ø³ÙŠØ·Ø© ========
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SimpleCheatGUI"
ScreenGui.Parent = game.CoreGui
ScreenGui.ResetOnSpawn = false

-- Frame Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 250, 0, 300)
MainFrame.Position = UDim2.new(0.5, -125, 0.5, -150)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
MainFrame.BorderSizePixel = 0
MainFrame.BackgroundTransparency = 0.1
MainFrame.Parent = ScreenGui

-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
Title.BorderSizePixel = 0
Title.Text = "MOBILE CHEAT MENU"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 18
Title.Font = Enum.Font.SourceSansBold
Title.Parent = MainFrame

-- Ø²Ø± Ø¥ØºÙ„Ø§Ù‚
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -35, 0, 5)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.BorderSizePixel = 0
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 16
CloseButton.Font = Enum.Font.SourceSansBold
CloseButton.Parent = MainFrame

CloseButton.MouseButton1Click:Connect(function()
    ScreenGui.Enabled = not ScreenGui.Enabled
end)

-- ======== Ù†Ø¸Ø§Ù… ESP (Ù†ÙØ³ Ø§Ù„Ù…Ù„Ù) ========
local espEnabled = false
local espHighlights = {}

local function getTeamFrames()
    local success, redFrame, blueFrame = pcall(function()
        local playerGui = LocalPlayer:FindFirstChildOfClass("PlayerGui")
        if not playerGui then return nil, nil end
        local main = playerGui:FindFirstChild("Main")
        if not main then return nil, nil end
        local mainGameFrame = main:FindFirstChild("MainGameFrame")
        if not mainGameFrame then return nil, nil end
        local playersFrame = mainGameFrame:FindFirstChild("PlayersFrame")
        if not playersFrame then return nil, nil end
        return playersFrame:FindFirstChild("TeamRedFrame"), playersFrame:FindFirstChild("TeamBlueFrame")
    end)
    if success then
        return redFrame, blueFrame
    end
    return nil, nil
end

local function getFrameChildrenNames(frame)
    local names = {}
    if not frame then return names end
    for _, child in ipairs(frame:GetChildren()) do
        if child:IsA("Frame") then
            table.insert(names, child.Name)
        end
    end
    return names
end

local function sanitizeName(name)
    return tostring(name):gsub("%s+", "")
end

local function getEnemyPlayers()
    local redFrame, blueFrame = getTeamFrames()
    if not redFrame or not blueFrame then return {}, {} end

    local redPlayers = getFrameChildrenNames(redFrame)
    local bluePlayers = getFrameChildrenNames(blueFrame)

    local isLocalPlayerInRed = false
    local isLocalPlayerInBlue = false

    local sanitizedLocalPlayerName = sanitizeName(LocalPlayer.Name)

    for _, name in ipairs(redPlayers) do
        if sanitizeName(name) == sanitizedLocalPlayerName then
            isLocalPlayerInRed = true
            break
        end
    end

    for _, name in ipairs(bluePlayers) do
        if sanitizeName(name) == sanitizedLocalPlayerName then
            isLocalPlayerInBlue = true
            break
        end
    end

    if not isLocalPlayerInRed and not isLocalPlayerInBlue then
        return {}, {}
    end

    local enemyFrame = isLocalPlayerInRed and blueFrame or redFrame
    local enemyNames = getFrameChildrenNames(enemyFrame)

    local enemyPlayerInstances = {}
    for _, name in ipairs(enemyNames) do
        local player = Players:FindFirstChild(name)
        if player and player ~= LocalPlayer then
            table.insert(enemyPlayerInstances, player)
        end
    end

    local enemyTeamColor = isLocalPlayerInRed and Color3.fromRGB(0, 0, 255) or Color3.fromRGB(255, 0, 0)

    return enemyPlayerInstances, enemyTeamColor
end

local function removeHighlight(player)
    if espHighlights[player] then
        pcall(function() espHighlights[player]:Destroy() end)
        espHighlights[player] = nil
    end
end

local function updateHighlight(player, color)
    local character = player.Character
    if not character then removeHighlight(player) return end

    local highlight = espHighlights[player]
    if not highlight or not highlight.Parent then
        if highlight then removeHighlight(player) end
        highlight = Instance.new("Highlight")
        highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
        highlight.FillTransparency = 0.5
        highlight.OutlineTransparency = 0
        highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
        highlight.Parent = character
        espHighlights[player] = highlight
    end

    highlight.Adornee = character
    highlight.FillColor = color
end

local function updateAllHighlights()
    if not espEnabled then
        for player, _ in pairs(espHighlights) do removeHighlight(player) end
        return
    end

    local enemyPlayers, enemyColor = getEnemyPlayers()
    if not enemyPlayers then return end

    local currentEnemies = {}
    for _, player in ipairs(enemyPlayers) do
        currentEnemies[player] = true
        updateHighlight(player, enemyColor)
    end

    for player, _ in pairs(espHighlights) do
        if not currentEnemies[player] then removeHighlight(player) end
    end
end

-- Ø²Ø± ESP
local ESPButton = Instance.new("TextButton")
ESPButton.Size = UDim2.new(0.9, 0, 0, 40)
ESPButton.Position = UDim2.new(0.05, 0, 0.2, 0)
ESPButton.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
ESPButton.BorderSizePixel = 0
ESPButton.Text = "ESP: OFF"
ESPButton.TextColor3 = Color3.fromRGB(255, 50, 50)
ESPButton.TextSize = 16
ESPButton.Font = Enum.Font.SourceSansBold
ESPButton.Parent = MainFrame

ESPButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    
    if espEnabled then
        ESPButton.Text = "ESP: ON"
        ESPButton.TextColor3 = Color3.fromRGB(0, 255, 100)
        ESPButton.BackgroundColor3 = Color3.fromRGB(0, 100, 50)
        updateAllHighlights()
    else
        ESPButton.Text = "ESP: OFF"
        ESPButton.TextColor3 = Color3.fromRGB(255, 50, 50)
        ESPButton.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
        for player, _ in pairs(espHighlights) do removeHighlight(player) end
    end
    
    print("ESP: " .. (espEnabled and "ON" or "OFF"))
end)

-- ======== Ù†Ø¸Ø§Ù… Auto Shoot (Ù†ÙØ³ Ø§Ù„Ù…Ù„Ù) ========
local aimDistance = 250
local clickShootEnabled = false
local autoShootEnabled = false
local currentWeapon = nil
local isWeaponEquipped = false
local lastFireTime = 0
local fireDelay = 1.5

local function initializeWeaponScript()
    local character = LocalPlayer.Character
    if not character then
        currentWeapon = nil
        isWeaponEquipped = false
        return
    end

    local equippedTool
    for _, child in ipairs(character:GetChildren()) do
        if child:IsA("Tool") and child:FindFirstChild("fire") then
            equippedTool = child
            break
        end
    end

    if equippedTool and currentWeapon ~= equippedTool then
        currentWeapon = equippedTool
        isWeaponEquipped = true
    elseif not equippedTool and isWeaponEquipped then
        currentWeapon = nil
        isWeaponEquipped = false
    end
end

local function getClosestPlayer()
    local players = getEnemyPlayers()
    if not players or type(players) ~= "table" then return nil end

    local character = LocalPlayer.Character
    if not character or not character:IsDescendantOf(Workspace) then return nil end
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return nil end

    local closestPlayer, minDistance = nil, aimDistance or 100
    for _, player in ipairs(players) do
        if player and typeof(player) == "Instance" and player:IsA("Player") then
            local targetCharacter = player.Character
            if targetCharacter and targetCharacter:IsDescendantOf(Workspace) then
                local targetHrp = targetCharacter:FindFirstChild("HumanoidRootPart")
                local targetHumanoid = targetCharacter:FindFirstChild("Humanoid")
                if targetHrp and targetHumanoid and targetHumanoid.Health > 0 then
                    local success, distance = pcall(function() return (hrp.Position - targetHrp.Position).Magnitude end)
                    if success and distance < minDistance then
                        minDistance = distance
                        closestPlayer = player
                    end
                end
            end
        end
    end
    return closestPlayer
end

local function canSeeTarget(targetPlayer)
    if not targetPlayer then return false end

    local localCharacter = LocalPlayer.Character
    if not localCharacter or not localCharacter:IsDescendantOf(Workspace) then return false end
    local targetCharacter = targetPlayer.Character
    if not targetCharacter or not targetCharacter:IsDescendantOf(Workspace) then return false end

    local localHrp = localCharacter:FindFirstChild("HumanoidRootPart")
    local targetHrp = targetCharacter:FindFirstChild("HumanoidRootPart")
    local targetHumanoid = targetCharacter:FindFirstChild("Humanoid")

    if not localHrp or not targetHrp or not targetHumanoid then return false end

    local success, distance = pcall(function() return (localHrp.Position - targetHrp.Position).Magnitude end)
    if not success or distance > (aimDistance or 100) then return false end

    local raycastParams = RaycastParams.new()
    raycastParams.FilterType = Enum.RaycastFilterType.Blacklist
    raycastParams.FilterDescendantsInstances = { localCharacter }
    raycastParams.IgnoreWater = true

    local direction = targetHrp.Position - localHrp.Position
    local raycastResult = Workspace:Raycast(localHrp.Position, direction.Unit * math.min(distance, aimDistance or 100), raycastParams)

    if not raycastResult then return true end
    local hitPart = raycastResult.Instance
    if hitPart and hitPart:IsDescendantOf(targetCharacter) then
        return true
    end

    return false
end

local function shootLogic()
    if tick() - lastFireTime < fireDelay then return end
    lastFireTime = tick()
    if not isWeaponEquipped then return end
    local target = getClosestPlayer()
    if not target then return end
    if not canSeeTarget(target) then return end

    local localCharacter = LocalPlayer.Character
    if not localCharacter or not localCharacter:IsDescendantOf(Workspace) then return end
    local localHrp = localCharacter:FindFirstChild("HumanoidRootPart")
    if not localHrp then return end

    local targetCharacter = target.Character
    if not targetCharacter or not targetCharacter:IsDescendantOf(Workspace) then return end
    local targetHrp = targetCharacter:FindFirstChild("HumanoidRootPart")
    if not targetHrp then return end

    local predictedPosition = targetHrp.Position
    local handle = currentWeapon:FindFirstChild("Handle") or currentWeapon
    if not handle then return end

    pcall(function() currentWeapon.fire:FireServer() end)
    pcall(function()
        local beamRemote = ReplicatedStorage:FindFirstChild("LocalBeam")
        if beamRemote then
            beamRemote:Fire(handle, predictedPosition)
        end
        local showBeamRemote = currentWeapon:FindFirstChild("showBeam")
        if showBeamRemote then
            showBeamRemote:FireServer(predictedPosition, localHrp.Position, handle)
        end
    end)
end

-- Ø²Ø± Auto Shoot
local AutoShootButton = Instance.new("TextButton")
AutoShootButton.Size = UDim2.new(0.9, 0, 0, 40)
AutoShootButton.Position = UDim2.new(0.05, 0, 0.35, 0)
AutoShootButton.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
AutoShootButton.BorderSizePixel = 0
AutoShootButton.Text = "AUTO SHOOT: OFF"
AutoShootButton.TextColor3 = Color3.fromRGB(255, 50, 50)
AutoShootButton.TextSize = 16
AutoShootButton.Font = Enum.Font.SourceSansBold
AutoShootButton.Parent = MainFrame

AutoShootButton.MouseButton1Click:Connect(function()
    autoShootEnabled = not autoShootEnabled
    
    if autoShootEnabled then
        AutoShootButton.Text = "AUTO SHOOT: ON"
        AutoShootButton.TextColor3 = Color3.fromRGB(0, 255, 100)
        AutoShootButton.BackgroundColor3 = Color3.fromRGB(0, 100, 50)
    else
        AutoShootButton.Text = "AUTO SHOOT: OFF"
        AutoShootButton.TextColor3 = Color3.fromRGB(255, 50, 50)
        AutoShootButton.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
    end
    
    print("Auto Shoot: " .. (autoShootEnabled and "ON" or "OFF"))
end)

-- Ø²Ø± Click Shoot
local ClickShootButton = Instance.new("TextButton")
ClickShootButton.Size = UDim2.new(0.9, 0, 0, 40)
ClickShootButton.Position = UDim2.new(0.05, 0, 0.5, 0)
ClickShootButton.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
ClickShootButton.BorderSizePixel = 0
ClickShootButton.Text = "CLICK SHOOT: OFF"
ClickShootButton.TextColor3 = Color3.fromRGB(255, 50, 50)
ClickShootButton.TextSize = 16
ClickShootButton.Font = Enum.Font.SourceSansBold
ClickShootButton.Parent = MainFrame

ClickShootButton.MouseButton1Click:Connect(function()
    clickShootEnabled = not clickShootEnabled
    
    if clickShootEnabled then
        ClickShootButton.Text = "CLICK SHOOT: ON"
        ClickShootButton.TextColor3 = Color3.fromRGB(0, 255, 100)
        ClickShootButton.BackgroundColor3 = Color3.fromRGB(0, 100, 50)
    else
        ClickShootButton.Text = "CLICK SHOOT: OFF"
        ClickShootButton.TextColor3 = Color3.fromRGB(255, 50, 50)
        ClickShootButton.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
    end
    
    print("Click Shoot: " .. (clickShootEnabled and "ON" or "OFF"))
end)

-- Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø³Ø§ÙØ©
local DistanceFrame = Instance.new("Frame")
DistanceFrame.Size = UDim2.new(0.9, 0, 0, 50)
DistanceFrame.Position = UDim2.new(0.05, 0, 0.65, 0)
DistanceFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
DistanceFrame.BorderSizePixel = 0
DistanceFrame.Parent = MainFrame

local DistanceLabel = Instance.new("TextLabel")
DistanceLabel.Size = UDim2.new(0.6, 0, 1, 0)
DistanceLabel.Position = UDim2.new(0, 10, 0, 0)
DistanceLabel.BackgroundTransparency = 1
DistanceLabel.Text = "Aim Distance:"
DistanceLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
DistanceLabel.TextSize = 14
DistanceLabel.Font = Enum.Font.SourceSans
DistanceLabel.TextXAlignment = Enum.TextXAlignment.Left
DistanceLabel.Parent = DistanceFrame

local DistanceBox = Instance.new("TextBox")
DistanceBox.Size = UDim2.new(0.3, 0, 0, 25)
DistanceBox.Position = UDim2.new(0.65, 0, 0.25, 0)
DistanceBox.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
DistanceBox.BorderSizePixel = 0
DistanceBox.Text = "250"
DistanceBox.TextColor3 = Color3.fromRGB(255, 255, 255)
DistanceBox.TextSize = 14
DistanceBox.Font = Enum.Font.SourceSans
DistanceBox.PlaceholderText = "Distance"
DistanceBox.Parent = DistanceFrame

DistanceBox.FocusLost:Connect(function()
    local num = tonumber(DistanceBox.Text)
    if num then
        aimDistance = math.clamp(num, 1, 10000)
        DistanceBox.Text = tostring(aimDistance)
        print("Aim Distance set to: " .. aimDistance)
    else
        DistanceBox.Text = "250"
        aimDistance = 250
    end
end)

-- ======== Ø§Ù„Ø­Ù„Ù‚Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ========
RunService.Heartbeat:Connect(function()
    -- ØªØ­Ø¯ÙŠØ« ESP
    if espEnabled then
        pcall(updateAllHighlights)
    end
    
    -- ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ù„Ø§Ø­
    pcall(initializeWeaponScript)
    
    -- Auto Shoot
    if autoShootEnabled and isWeaponEquipped and currentWeapon then
        local target = getClosestPlayer()
        if target and canSeeTarget(target) then
            shootLogic()
        end
    end
end)

-- Click Shoot
Mouse.Button1Down:Connect(function()
    if clickShootEnabled and isWeaponEquipped and currentWeapon then
        local target = getClosestPlayer()
        if target and canSeeTarget(target) then
            shootLogic()
        end
    end
end)

-- ØªØªØ¨Ø¹ Ø§Ù„Ø´Ø®ØµÙŠØ§Øª
local function trackCharacter(player)
    local function onCharAdded(character)
        task.wait(0.1)
        if espEnabled then
            updateAllHighlights()
        end
    end
    player.CharacterAdded:Connect(onCharAdded)
end

for _, player in ipairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        trackCharacter(player)
    end
end

Players.PlayerAdded:Connect(function(player)
    if player ~= LocalPlayer then
        trackCharacter(player)
    end
end)

LocalPlayer.CharacterAdded:Connect(function()
    task.wait(0.1)
    if espEnabled then
        updateAllHighlights()
    end
end)

Players.PlayerRemoving:Connect(function(player)
    removeHighlight(player)
end)

-- Ø²Ø± Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
local HideButton = Instance.new("TextButton")
HideButton.Size = UDim2.new(0.9, 0, 0, 35)
HideButton.Position = UDim2.new(0.05, 0, 0.85, 0)
HideButton.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
HideButton.BorderSizePixel = 0
HideButton.Text = "HIDE MENU"
HideButton.TextColor3 = Color3.fromRGB(255, 255, 255)
HideButton.TextSize = 14
HideButton.Font = Enum.Font.SourceSansBold
HideButton.Parent = MainFrame

HideButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible
    HideButton.Text = MainFrame.Visible and "HIDE MENU" or "SHOW MENU"
end)

-- ======== Ø§Ù„Ø¥Ù†Ù‡Ø§Ø¡ ========
print("========================================")
print("ðŸŽ® MOBILE CHEAT SYSTEM LOADED!")
print("âœ… ESP System: Ready")
print("ðŸŽ¯ Auto Shoot System: Ready")
print("ðŸ“± GUI: Press buttons to toggle features")
print("========================================")

-- Ø¬Ø¹Ù„ Frame Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø³Ø­Ø¨
local dragging = false
local dragInput, dragStart, startPos

local function update(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

MainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and (input == dragInput) then
        update(input)
    end
end)