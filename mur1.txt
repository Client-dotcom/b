-- MVS Mobile UI Version for Delta Executor
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")

local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- إعدادات واجهة الجوال
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MVS_MobileUI"
screenGui.Parent = CoreGui
screenGui.ResetOnSpawn = false

local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 350, 0, 500)
mainFrame.Position = UDim2.new(0.5, -175, 0.5, -250)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
mainFrame.BorderSizePixel = 2
mainFrame.BorderColor3 = Color3.fromRGB(0, 150, 255)
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 10)
corner.Parent = mainFrame

local title = Instance.new("TextLabel")
title.Name = "Title"
title.Size = UDim2.new(1, 0, 0, 40)
title.Position = UDim2.new(0, 0, 0, 0)
title.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
title.Text = "1kzuya MVS Mobile"
title.TextColor3 = Color3.fromRGB(0, 200, 255)
title.TextSize = 20
title.Font = Enum.Font.GothamBold
title.Parent = mainFrame

local closeBtn = Instance.new("TextButton")
closeBtn.Name = "CloseBtn"
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(1, -35, 0, 5)
closeBtn.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
closeBtn.Text = "X"
closeBtn.TextColor3 = Color3.new(1, 1, 1)
closeBtn.TextSize = 18
closeBtn.Font = Enum.Font.GothamBold
closeBtn.Parent = mainFrame

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, 15)
closeCorner.Parent = closeBtn

local tabButtonsFrame = Instance.new("Frame")
tabButtonsFrame.Name = "TabButtons"
tabButtonsFrame.Size = UDim2.new(1, 0, 0, 50)
tabButtonsFrame.Position = UDim2.new(0, 0, 0, 40)
tabButtonsFrame.BackgroundTransparency = 1
tabButtonsFrame.Parent = mainFrame

local tabsFrame = Instance.new("Frame")
tabsFrame.Name = "Tabs"
tabsFrame.Size = UDim2.new(1, -20, 1, -100)
tabsFrame.Position = UDim2.new(0, 10, 0, 100)
tabsFrame.BackgroundTransparency = 1
tabsFrame.ClipsDescendants = true
tabsFrame.Parent = mainFrame

-- إنشاء تبويبات
local tabs = {}
local currentTab = nil

local function createTab(name)
    local tabButton = Instance.new("TextButton")
    tabButton.Name = name .. "TabBtn"
    tabButton.Size = UDim2.new(0.5, 0, 1, 0)
    tabButton.Position = #tabs == 0 and UDim2.new(0, 0, 0, 0) or UDim2.new(0.5, 0, 0, 0)
    tabButton.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    tabButton.Text = name
    tabButton.TextColor3 = Color3.fromRGB(200, 200, 200)
    tabButton.TextSize = 16
    tabButton.Font = Enum.Font.Gotham
    tabButton.Parent = tabButtonsFrame
    
    local tabButtonCorner = Instance.new("UICorner")
    tabButtonCorner.CornerRadius = UDim.new(0, 8)
    tabButtonCorner.Parent = tabButton
    
    local tabContent = Instance.new("ScrollingFrame")
    tabContent.Name = name .. "Content"
    tabContent.Size = UDim2.new(1, 0, 1, 0)
    tabContent.Position = UDim2.new(0, 0, 0, 0)
    tabContent.BackgroundTransparency = 1
    tabContent.BorderSizePixel = 0
    tabContent.ScrollingEnabled = true
    tabContent.ScrollBarThickness = 4
    tabContent.ScrollBarImageColor3 = Color3.fromRGB(0, 150, 255)
    tabContent.Visible = false
    tabContent.AutomaticCanvasSize = Enum.AutomaticSize.Y
    tabContent.Parent = tabsFrame
    
    local layout = Instance.new("UIListLayout")
    layout.Padding = UDim.new(0, 8)
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.Parent = tabContent
    
    local padding = Instance.new("UIPadding")
    padding.PaddingTop = UDim.new(0, 10)
    padding.PaddingLeft = UDim.new(0, 5)
    padding.PaddingRight = UDim.new(0, 5)
    padding.Parent = tabContent
    
    local tabData = {
        Button = tabButton,
        Content = tabContent,
        Elements = {}
    }
    
    table.insert(tabs, tabData)
    
    tabButton.MouseButton1Click:Connect(function()
        if currentTab then
            currentTab.Content.Visible = false
            currentTab.Button.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
        end
        
        currentTab = tabData
        tabContent.Visible = true
        tabButton.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
    end)
    
    return tabData
end

-- وظائف مساعدة للواجهة
local function createLabel(parent, text)
    local label = Instance.new("TextLabel")
    label.Name = "Label"
    label.Size = UDim2.new(1, 0, 0, 30)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = Color3.fromRGB(220, 220, 220)
    label.TextSize = 16
    label.Font = Enum.Font.Gotham
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = parent.Content
    return label
end

local function createToggle(parent, name, callback)
    local frame = Instance.new("Frame")
    frame.Name = name .. "Toggle"
    frame.Size = UDim2.new(1, 0, 0, 40)
    frame.BackgroundTransparency = 1
    frame.Parent = parent.Content
    
    local label = Instance.new("TextLabel")
    label.Name = "Label"
    label.Size = UDim2.new(0.7, 0, 1, 0)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = name
    label.TextColor3 = Color3.fromRGB(220, 220, 220)
    label.TextSize = 16
    label.Font = Enum.Font.Gotham
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame
    
    local toggleBtn = Instance.new("TextButton")
    toggleBtn.Name = "Toggle"
    toggleBtn.Size = UDim2.new(0, 50, 0, 25)
    toggleBtn.Position = UDim2.new(1, -55, 0.5, -12.5)
    toggleBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 90)
    toggleBtn.Text = ""
    toggleBtn.Parent = frame
    
    local toggleCorner = Instance.new("UICorner")
    toggleCorner.CornerRadius = UDim.new(0, 12)
    toggleCorner.Parent = toggleBtn
    
    local toggleCircle = Instance.new("Frame")
    toggleCircle.Name = "Circle"
    toggleCircle.Size = UDim2.new(0, 21, 0, 21)
    toggleCircle.Position = UDim2.new(0, 2, 0.5, -10.5)
    toggleCircle.BackgroundColor3 = Color3.fromRGB(220, 220, 220)
    toggleCircle.Parent = toggleBtn
    
    local circleCorner = Instance.new("UICorner")
    circleCorner.CornerRadius = UDim.new(1, 0)
    circleCorner.Parent = toggleCircle
    
    local state = false
    
    local function updateToggle()
        if state then
            toggleBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
            toggleCircle.Position = UDim2.new(1, -23, 0.5, -10.5)
        else
            toggleBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 90)
            toggleCircle.Position = UDim2.new(0, 2, 0.5, -10.5)
        end
    end
    
    toggleBtn.MouseButton1Click:Connect(function()
        state = not state
        updateToggle()
        if callback then
            callback(state)
        end
    end)
    
    updateToggle()
    
    parent.Elements[name] = {
        Set = function(newState)
            state = newState
            updateToggle()
            if callback then
                callback(state)
            end
        end,
        Get = function()
            return state
        end
    }
    
    return parent.Elements[name]
end

local function createInput(parent, name, placeholder, callback)
    local frame = Instance.new("Frame")
    frame.Name = name .. "Input"
    frame.Size = UDim2.new(1, 0, 0, 60)
    frame.BackgroundTransparency = 1
    frame.Parent = parent.Content
    
    local label = Instance.new("TextLabel")
    label.Name = "Label"
    label.Size = UDim2.new(1, 0, 0, 25)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = name
    label.TextColor3 = Color3.fromRGB(220, 220, 220)
    label.TextSize = 16
    label.Font = Enum.Font.Gotham
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame
    
    local textBox = Instance.new("TextBox")
    textBox.Name = "Input"
    textBox.Size = UDim2.new(1, 0, 0, 30)
    textBox.Position = UDim2.new(0, 0, 0, 30)
    textBox.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
    textBox.TextColor3 = Color3.new(1, 1, 1)
    textBox.PlaceholderText = placeholder
    textBox.Text = ""
    textBox.TextSize = 14
    textBox.Font = Enum.Font.Gotham
    textBox.ClearTextOnFocus = false
    textBox.Parent = frame
    
    local textBoxCorner = Instance.new("UICorner")
    textBoxCorner.CornerRadius = UDim.new(0, 6)
    textBoxCorner.Parent = textBox
    
    textBox.FocusLost:Connect(function(enterPressed)
        if enterPressed then
            if callback then
                callback(textBox.Text)
            end
        end
    end)
    
    parent.Elements[name] = {
        Set = function(text)
            textBox.Text = tostring(text)
            if callback then
                callback(text)
            end
        end,
        Get = function()
            return textBox.Text
        end
    }
    
    return parent.Elements[name]
end

-- إنشاء التبويبات
local AimAssistTab = createTab("Aim Assist")
local ESPTab = createTab("ESP")

-- تفعيل التبويب الأول
if tabs[1] then
    tabs[1].Button.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
    tabs[1].Content.Visible = true
    currentTab = tabs[1]
end

-- زر الإغلاق
closeBtn.MouseButton1Click:Connect(function()
    screenGui:Destroy()
end)

-- الإشعار الأولي
local function showNotification(title, message)
    local notif = Instance.new("Frame")
    notif.Size = UDim2.new(0, 300, 0, 80)
    notif.Position = UDim2.new(0.5, -150, 0.1, 0)
    notif.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    notif.BorderSizePixel = 2
    notif.BorderColor3 = Color3.fromRGB(0, 150, 255)
    notif.Parent = screenGui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = notif
    
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1, 0, 0, 30)
    titleLabel.Position = UDim2.new(0, 0, 0, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = title
    titleLabel.TextColor3 = Color3.fromRGB(0, 200, 255)
    titleLabel.TextSize = 18
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.Parent = notif
    
    local msgLabel = Instance.new("TextLabel")
    msgLabel.Size = UDim2.new(1, -20, 0, 40)
    msgLabel.Position = UDim2.new(0, 10, 0, 30)
    msgLabel.BackgroundTransparency = 1
    msgLabel.Text = message
    msgLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
    msgLabel.TextSize = 14
    msgLabel.Font = Enum.Font.Gotham
    msgLabel.TextWrapped = true
    msgLabel.Parent = notif
    
    task.wait(5)
    notif:Destroy()
end

showNotification("1kzuya MVS Loaded", "Mobile Version - Report Any Bugs")

-- الآن نفس دوال اللعبة من السكربت الأصلي (بدون تغيير)
-- -----------------------------------------------------------------
-- كل الدوال الأصلية تبقى كما هي تماما

local function getTeamFrames()
    local success, redFrame, blueFrame = pcall(function()
        local playerGui = LocalPlayer:FindFirstChildOfClass("PlayerGui")
        if not playerGui then return nil, nil end
        local main = playerGui:FindFirstChild("Main")
        if not main then return nil, nil end
        local mainGameFrame = main:FindFirstChild("MainGameFrame")
        if not mainGameFrame then return nil, nil end
        local playersFrame = mainGameFrame:FindFirstChild("PlayersFrame")
        if not playersFrame then return nil, nil end
        return playersFrame:FindFirstChild("TeamRedFrame"), playersFrame:FindFirstChild("TeamBlueFrame")
    end)
    if success then
        return redFrame, blueFrame
    end
    return nil, nil
end

local function getFrameChildrenNames(frame)
    local names = {}
    if not frame then return names end
    for _, child in ipairs(frame:GetChildren()) do
        if child:IsA("Frame") then
            table.insert(names, child.Name)
        end
    end
    return names
end

local function sanitizeName(name)
    return tostring(name):gsub("%s+", "")
end

local function getEnemyPlayers()
    local redFrame, blueFrame = getTeamFrames()
    if not redFrame or not blueFrame then return {}, {} end

    local redPlayers = getFrameChildrenNames(redFrame)
    local bluePlayers = getFrameChildrenNames(blueFrame)

    local isLocalPlayerInRed = false
    local isLocalPlayerInBlue = false

    local sanitizedLocalPlayerName = sanitizeName(LocalPlayer.Name)

    for _, name in ipairs(redPlayers) do
        if sanitizeName(name) == sanitizedLocalPlayerName then
            isLocalPlayerInRed = true
            break
        end
    end

    for _, name in ipairs(bluePlayers) do
        if sanitizeName(name) == sanitizedLocalPlayerName then
            isLocalPlayerInBlue = true
            break
        end
    end

    if not isLocalPlayerInRed and not isLocalPlayerInBlue then
        return {}, {}
    end

    local enemyFrame = isLocalPlayerInRed and blueFrame or redFrame
    local enemyNames = getFrameChildrenNames(enemyFrame)

    local enemyPlayerInstances = {}
    for _, name in ipairs(enemyNames) do
        local player = Players:FindFirstChild(name)
        if player and player ~= LocalPlayer then
            table.insert(enemyPlayerInstances, player)
        end
    end

    local enemyTeamColor = isLocalPlayerInRed and Color3.fromRGB(0, 0, 255) or Color3.fromRGB(255, 0, 0)

    return enemyPlayerInstances, enemyTeamColor
end

-- إضافة عناصر واجهة Aim Assist
createLabel(AimAssistTab, "Easy Win Fr")

local aimDistance = 250
local clickShootEnabled = false
local autoShootEnabled = false
local currentWeapon = nil
local isWeaponEquipped = false

_G.BlockClick = false

local function updateWeaponScripts()
    pcall(function()
        if not currentWeapon or not currentWeapon.Parent or not currentWeapon:IsDescendantOf(game) then
            return
        end

        local scripts = {}
        for _, descendant in ipairs(currentWeapon:GetDescendants()) do
            if descendant:IsA("Script") or descendant:IsA("LocalScript") then
                table.insert(scripts, descendant)
            end
        end
        table.insert(scripts, currentWeapon:FindFirstChild("Client"))
        table.insert(scripts, currentWeapon:FindFirstChild("GunScript"))

        for _, script in ipairs(scripts) do
            if script and script.Disabled ~= _G.BlockClick then
                script.Disabled = _G.BlockClick
            end
        end
    end)
end

local function initializeWeaponScript()
    local character = LocalPlayer.Character
    if not character then
        currentWeapon = nil
        isWeaponEquipped = false
        return
    end

    local equippedTool
    for _, child in ipairs(character:GetChildren()) do
        if child:IsA("Tool") and child:FindFirstChild("fire") then
            equippedTool = child
            break
        end
    end

    if equippedTool and currentWeapon ~= equippedTool then
        currentWeapon = equippedTool
        isWeaponEquipped = true
        updateWeaponScripts()
    elseif not equippedTool and isWeaponEquipped then
        currentWeapon = nil
        isWeaponEquipped = false
    end
end

local function updateBlockState()
    if (clickShootEnabled or autoShootEnabled) and _G.BlockClick then
        _G.BlockClick = false
        updateWeaponScripts()
    elseif not (clickShootEnabled or autoShootEnabled) and not _G.BlockClick then
        _G.BlockClick = true
        updateWeaponScripts()
    end
end

local function SetClickShootState(state)
    clickShootEnabled = state
    updateBlockState()
end

local function SetAutoShootState(state)
    autoShootEnabled = state
    updateBlockState()
end

-- إضافة عناصر التحكم
createInput(AimAssistTab, "Aim Distance", "1 - 10000", function(text)
    local num = tonumber(text)
    if num then
        aimDistance = math.clamp(num, 1, 10000)
    end
end)

createLabel(AimAssistTab, "Shoot Types (For Guns)")
createToggle(AimAssistTab, "Click Shoot", SetClickShootState)
createToggle(AimAssistTab, "Auto Shoot", SetAutoShootState)

-- Backpack listeners
if LocalPlayer.Backpack then
    LocalPlayer.Backpack.ChildRemoved:Connect(function(child)
        if child:IsA("Tool") and child == currentWeapon then
            isWeaponEquipped = false
            task.wait(0.1)
            initializeWeaponScript()
        end
    end)
    LocalPlayer.Backpack.ChildAdded:Connect(function(child)
        if child:IsA("Tool") and child:FindFirstChild("fire") and currentWeapon and child.Name == currentWeapon.Name then
            currentWeapon = nil
            isWeaponEquipped = false
            updateWeaponScripts()
        end
    end)
end

task.spawn(function()
    while task.wait(0.1) do
        initializeWeaponScript()
    end
end)

-- Closest player & visibility
local function getClosestPlayer(playerListProvider)
    local players = playerListProvider()
    if not players or type(players) ~= "table" then return nil end

    local character = LocalPlayer.Character
    if not character or not character:IsDescendantOf(Workspace) then return nil end
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return nil end

    local closestPlayer, minDistance = nil, aimDistance or 100
    for _, player in ipairs(players) do
        if player and typeof(player) == "Instance" and player:IsA("Player") then
            local targetCharacter = player.Character
            if targetCharacter and targetCharacter:IsDescendantOf(Workspace) then
                local targetHrp = targetCharacter:FindFirstChild("HumanoidRootPart")
                local targetHumanoid = targetCharacter:FindFirstChild("Humanoid")
                if targetHrp and targetHumanoid and targetHumanoid.Health > 0 then
                    local success, distance = pcall(function() return (hrp.Position - targetHrp.Position).Magnitude end)
                    if success and distance < minDistance then
                        minDistance = distance
                        closestPlayer = player
                    end
                end
            end
        end
    end
    return closestPlayer
end

local function canSeeTarget(targetPlayer)
    if not targetPlayer then return false end

    local localCharacter = LocalPlayer.Character
    if not localCharacter or not localCharacter:IsDescendantOf(Workspace) then return false end
    local targetCharacter = targetPlayer.Character
    if not targetCharacter or not targetCharacter:IsDescendantOf(Workspace) then return false end

    local localHrp = localCharacter:FindFirstChild("HumanoidRootPart")
    local targetHrp = targetCharacter:FindFirstChild("HumanoidRootPart")
    local targetHumanoid = targetCharacter:FindFirstChild("Humanoid")

    if not localHrp or not targetHrp or not targetHumanoid then return false end

    local success, distance = pcall(function() return (localHrp.Position - targetHrp.Position).Magnitude end)
    if not success or distance > (aimDistance or 100) then return false end

    local raycastParams = RaycastParams.new()
    raycastParams.FilterType = Enum.RaycastFilterType.Blacklist
    raycastParams.FilterDescendantsInstances = { localCharacter }
    raycastParams.IgnoreWater = true
    raycastParams.CollisionGroup = "Default"

    local direction = targetHrp.Position - localHrp.Position
    local raycastResult = Workspace:Raycast(localHrp.Position, direction.Unit * math.min(distance, aimDistance or 100), raycastParams)

    if not raycastResult then return true end
    local hitPart = raycastResult.Instance
    if hitPart and hitPart:IsDescendantOf(targetCharacter) then
        return true
    end

    return false
end

local lastFireTime = 0
local fireDelay = 1.5

local function shootLogic()
    if tick() - lastFireTime < fireDelay then return end
    lastFireTime = tick()
    if not isWeaponEquipped then return end
    local target = getClosestPlayer(getEnemyPlayers)
    if not target then return end
    if not canSeeTarget(target) then return end

    local localCharacter = LocalPlayer.Character
    if not localCharacter or not localCharacter:IsDescendantOf(Workspace) then return end
    local localHrp = localCharacter:FindFirstChild("HumanoidRootPart")
    if not localHrp then return end

    local targetCharacter = target.Character
    if not targetCharacter or not targetCharacter:IsDescendantOf(Workspace) then return end
    local targetHrp = targetCharacter:FindFirstChild("HumanoidRootPart")
    if not targetHrp then return end

    local predictedPosition = targetHrp.Position
    local handle = currentWeapon:FindFirstChild("Handle") or currentWeapon
    if not handle then return end

    pcall(function() currentWeapon.fire:FireServer() end)
    pcall(function()
        local beamRemote = ReplicatedStorage:FindFirstChild("LocalBeam")
        if beamRemote then
            beamRemote:Fire(handle, predictedPosition)
        end
        local showBeamRemote = currentWeapon:FindFirstChild("showBeam")
        if showBeamRemote then
            showBeamRemote:FireServer(predictedPosition, localHrp.Position, handle)
        end
    end)
    pcall(function()
        local direction = (predictedPosition - localHrp.Position).Unit
        currentWeapon.kill:FireServer(target, direction, localHrp.Position)
    end)
end

task.spawn(function()
    while RunService.Heartbeat:Wait() do
        if autoShootEnabled and isWeaponEquipped and currentWeapon and not _G.BlockClick then
            local target = getClosestPlayer(getEnemyPlayers)
            if target and canSeeTarget(target) then
                shootLogic()
            end
        end
    end
end)

Mouse.Button1Down:Connect(function()
    if clickShootEnabled and isWeaponEquipped and currentWeapon and not _G.BlockClick then
        local target = getClosestPlayer(getEnemyPlayers)
        if target and canSeeTarget(target) then
            shootLogic()
        end
    end
end)

-- ESP Tab
createLabel(ESPTab, "ESP Enemy Team")

local espEnabled = false
local espHighlights = {}

local function removeHighlight(player)
    if espHighlights[player] then
        pcall(function() espHighlights[player]:Destroy() end)
        espHighlights[player] = nil
    end
end

local function updateHighlight(player, color)
    local character = player.Character
    if not character then removeHighlight(player) return end

    local highlight = espHighlights[player]
    if not highlight or not highlight.Parent then
        if highlight then removeHighlight(player) end
        highlight = Instance.new("Highlight")
        highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
        highlight.FillTransparency = 0.5
        highlight.OutlineTransparency = 0
        highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
        highlight.Parent = character
        espHighlights[player] = highlight
    end

    highlight.Adornee = character
    highlight.FillColor = color
end

local function updateAllHighlights()
    if not espEnabled then
        for player, _ in pairs(espHighlights) do removeHighlight(player) end
        return
    end

    local enemyPlayers, enemyColor = getEnemyPlayers()
    if not enemyPlayers then return end

    local currentEnemies = {}
    for _, player in ipairs(enemyPlayers) do
        currentEnemies[player] = true
        updateHighlight(player, enemyColor)
    end

    for player, _ in pairs(espHighlights) do
        if not currentEnemies[player] then removeHighlight(player) end
    end
end

createToggle(ESPTab, "Enable ESP", function(state)
    espEnabled = state
    updateAllHighlights()
end)

RunService.Heartbeat:Connect(function()
    if espEnabled then pcall(updateAllHighlights) end
end)

-- Handles respawn and player joins
local function trackCharacter(player)
    local function onCharAdded(character)
        task.wait(0.1)
        if espEnabled then updateAllHighlights() end
    end
    player.CharacterAdded:Connect(onCharAdded)
end

for _, player in ipairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then trackCharacter(player) end
end

Players.PlayerAdded:Connect(function(player)
    if player ~= LocalPlayer then trackCharacter(player) end
end)

LocalPlayer.CharacterAdded:Connect(function()
    task.wait(0.1)
    if espEnabled then updateAllHighlights() end
end)

Players.PlayerRemoving:Connect(function(player)
    removeHighlight(player)
end)

-- زر إظهار/إخفاء الواجهة (للجوال)
local toggleBtn = Instance.new("TextButton")
toggleBtn.Name = "ToggleUI"
toggleBtn.Size = UDim2.new(0, 60, 0, 60)
toggleBtn.Position = UDim2.new(0, 20, 0.5, -30)
toggleBtn.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
toggleBtn.Text = "MVS"
toggleBtn.TextColor3 = Color3.new(1, 1, 1)
toggleBtn.TextSize = 16
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.Visible = true
toggleBtn.Parent = screenGui

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 30)
toggleCorner.Parent = toggleBtn

toggleBtn.MouseButton1Click:Connect(function()
    mainFrame.Visible = not mainFrame.Visible
end)

print("1kzuya MVS Mobile Loaded Successfully!")